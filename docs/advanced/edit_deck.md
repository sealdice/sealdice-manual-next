---
lang: zh-cn
title: 编写牌堆
---

# 编写牌堆

::: info 本节内容

本节将介绍牌堆的编写，请善用侧边栏和搜索，按需阅读文档。

:::

## 概览

::: info 用什么打开&编写牌堆？

我们非常建议使用更专业化的编辑器来编写牌堆，如果你不知道选择什么，可以尝试一下 [vscode](https://code.visualstudio.com) 或者 [sublime text](https://www.sublimetext.com)。

更专业化的编辑器能更好地帮助你编写牌堆，提供了语法高亮、错误检查、编码转换等功能。*不建议使用 windows 自带记事本等工具编写*。

:::

海豹核心目前支持 `json` `yaml` `toml`*（新）* 格式的牌堆编写。如果对其中某种格式的语法有了解，建议选择熟悉的格式。如果都不了解，建议选择使用适用性最广的 `json` 格式。当然，如果你的海豹版本较新，我们也推荐你尝试了解 `toml` 格式的牌堆编写。

::: warning 牌堆文件的编码

**永远**使用 UTF-8 编码来编写牌堆。

:::

### 如果你会json语法

- draw key 指令中key是对象名，对象key是数组，数组key中的元素就是抽取项  

- key 与 _key 两种格式的区别是 _key 不会在 draw keys 指令中显示

- 字符串中的 {otherkey} 有特殊意义 表示把 draw otherkey 指令的结果组
  合到原字符串中

  > {%key}放回抽取 {key}不放回 迭代上限是……
  >
  > 暂不支持，因此不明

- 字符串中的[exp] 里会先执行其中的投骰表达式 exp 再组合到原字符串里

  > 例如 [1d100] 在最终结果中是1

- 字符串 ::数字:: 格式以开头时表示权重 也就是概率 支持 :::[1d100]:: 格
  式 尽管意义不明

- 字符串里可以插入CQ code 和 其他 Seal 在回复中支持的写法 比如[图:]

### 如果你会YAML语法

- 还是要看编写方法 yaml 因为有格式要求

### 建议的格式

#### 对于json

```json
{
    "署名":[
        "seal尊重牌堆作者的权力,因此建议在你的牌堆里面加上如下的内容",
        "它们将在draw desc指令中被公示",
        "当然,你也可以选择匿名,这只是一个建议"
    ],
    "_title":["文件名"],
    "_author":["作者名"],
    "_date":["发布时间"],
    "_version":["牌堆版本"],
    "_brief":["牌堆的简介"],
    "其他":[
        "如果你有大量相似的词条,请尽量使用{}来进行调用",
        "请尊重别人的权力,仅仅修改了一点内容后就当作全新的牌堆来发布的行为是禁止的",
        "夹带私货的行为最好在简介中写出"
    ],
    "对于带图的牌堆":[
        "seal搜索decks文件夹下子目录时，跳过名为assets 或者 images的文件夹",
        "这意味这这两个目录下的文件不会被视为牌堆文件,你可以在里面放图片",
        "建议将整个牌堆做成目录，并将配套图片放入assets子目录中，方便压缩打包后发布"
        "具体压缩方法,选中牌堆文件和assets目录压缩,压缩包名为'牌堆的名字'。"，
        "对于这样的牌堆,解压后直接拖进decks目录就能用"
    ],
    "_牌堆名图片路径":["[图:data/decks/牌堆的名字/assets/"],
    "key":["你的图是{_牌堆名图片路径}图片名及后缀]"],
    "对于QQ平台,把 [图: 换成 [CQ:image,file=data/decks/牌堆的名字/assets/ 也是可以的",
    "注意[]点完整性"
}
```

#### 对于YAML

- 按照编写方法即可

## 不在乎原理的教学

>  仍旧建议随手学一下两种文件格式

### JSON牌堆基本

```json
{
    "key 也就draw指令后面跟的东西":[
        "这是一个可能被抽到东西(后面叫他元素)，如果是文字，必须被一对英文引号包裹住",
        "第二个可能被抽到元素，记得给上面那个兄弟加个英文逗号",
        "这是最后一个，这一个不能加逗号"
    ],
    "key 如果不止一个key，写第二个key时记得给上面的[]后面加一个,":[
        "如果没有再后面key了 ]后面就没有,号",
        123456789,
        "如上,纯数字可以不加英文引号",
        "每一个key以及能通过他抽取的在这里都叫做牌组,一群牌组叫牌堆",
        "最后记得用{}包裹住所有的牌组",
        "这里还是建议用点好用的编辑器,别的不说,标点主动补成一对就和自动缩进很舒服",
        "也能很直观的看到编码,牌堆编写请使用 UTF-8 编码",
        "换行和缩进其实没有什么意义,主要是看着好看,但是",
        "两个英文引号之间是不能换行的,这是完全不合语法的",
        "补充:在牌堆中插入图片可以使用CQ码,比如这样",
        "替身!!![CQ:image,file=data/images/JOJO替身集/倒吊男.jpg]",
        "对于带图的牌堆,可以看看下面的'建议的格式'一节。"
        "当然的，同样利用CQ码的语音、表情等等都可以这样",
        "至于CQ码的详细内容，见 https://docs.go-cqhttp.org/cqcode "
	]
}
```

### JSON牌堆技巧

```json
{
    "牌组之间的调用":[
        "假如我想实现的抽取句子只有一点不同,比如下面",
        "今天吃饼干",
        "今天吃海豹",
        "那么,你可以分开来写,比如下面"
    ],
    "吃什么":[
        "今天吃{食物}"
    ],
    "食物":[
        "海豹",
        "龙",
        "扁面蛸"
    ],
    "放回和不放回":[
        "显而易见的,{key}表示从牌组key中抽出一个元素合并到自己的元素中",
        "上面的方法,我姑且称为'调用'。",
        "上面的例子里,'吃什么'牌组调用了'食物'牌组",
        "除了{key}之外,还有{%key}这种格式,含有%将采取放回抽取，否则为不放回抽取",
        "seal目前没有实现不放回抽取，预计会实现针对群的不放回",
        "自然的,要小心\"食物\":[\"{食物}\"]这种情况,无限的自我调用"
    ],
    "特殊的符号":[
        "你可能注意到我在上面用了一个怪怪的 \" 反斜杠+英文引号"
        "因为引号在json里面已经用来表示一个文本了,所以不得不用 \" 来表示原本的意思",
        "反斜杠表示转义,有了特别的表示,于是和引号一样,两个反斜杠才是真的反斜杠 \\ ",
        "在上面说过两个英文引号之间不能换行要输出里面换行就要用到换行的转义符 \n",
        "你能看到上面的灰掉了,就是因为在引号之间换行了"
    ],
    "多吃点海豹":[
        "我想用 draw 多抽一点海豹来吃,怎么做",
        "在古老的时代,那些人是这样做的",
        "ctrl c+v",
        "海豹","海豹","海豹","海豹","海豹","海豹",
        "海豹","海豹","海豹","海豹","海豹","海豹",
        "海豹","海豹","海豹","海豹","海豹","海豹",
        "海豹","海豹","海豹","海豹","海豹","海豹",
        "海豹","海豹","海豹","海豹","海豹","海豹",
        "通过重复来调整概率,简直是可怕,幸好后来有了一个新东西",
        "::1:: 两个英文冒号+数字+两个英文冒号写在文本前面表示权重,下面是例子",
        "::23::海豹",
        "可以简单理解为中间的数字表示重复几次",
        "除此之外,在一些远古的牌堆,你还能看见"
    ],
    "数字":[1,2,3,4,5,6,7,8,9,10],
    "幸好我入坑晚点":[
        "现在你不用专门写一个数字牌堆来生成随机数了",
        "你可以[1d100]来表示1-100的随机数",
        "[]里面可以填写任意合法(合法是符合语法)的投骰表达式",
        "一些很实用的牌堆,比如调查员生成就是这样写,幸运:[3d6*5]",
        "你甚至可以::[1d100]::来写一些随机的权重"
    ],
    "_我不想给别人draw我的牌堆":[
        "在key前面加一个_,变成_key",
        "这样的牌组不可以使用draw指令抽取,但仍然可以通过{_key}调用",
        "初衷大概就是修饰一下你的draw key指令",
        "即前面有下划线的牌组不会在draw key中出现"
    ],
    "其他的":[
        "一些编辑器提供了格式化文档的功能，比如手机上用的MT管理器，你可以用他检查（格式化失败就是写错了）",
        "甚至格式化的时候可以把那些不合法的换行变成\n,这样就不用想象输出的排版了"
    ]
}

```

### YAML牌堆

```yaml
name: 塔骰格式要求比Dice!格式严格 也更加方便 在这里填牌堆名字
author: 在这里填写作者名字
version: 这里版本号
command: 指令名字 也就是keys里的内容
desc: 牌堆的简介
includes:
#好事是seal暂不支持 因此下面的可以无视
#用#号开头的是注释 不会影响牌堆 怎样写都可以
#includes是json牌堆没有的 意思包含的可抽取key 也就说你没必要通过_key来修饰keys命令了
#塔的抽牌格式是 deck command <可选的子命令>
    - default # 这里等价与command项 抽取时是 deck command
    - "key" # 子命令 抽取时是 deck command key
default:
    - "{%key0}" # 与Dice恰好相反 这里是不放回 暂不支持
    - "{%key1}" # 这是放回抽取 暂不支持
    - "正常的元素" # 也就是被抽取的内容
key:
    - "如果你会yaml语法，那么你可以去看看json的写法，除了上面说过的基本一致"
    - "如果不会 那你就学 或者 套格式"
key1：
    - "贴着一行的开头写key 然后打个英文冒号"
    - "换行 打一个空格 打一个减号 然后是引号包裹的内容"
    - "空格数量无所谓 但你要保证他们对齐 也就是同一层级"
key2:
- "呃" # 没了 其他编写牌堆的技巧看json的那
```
