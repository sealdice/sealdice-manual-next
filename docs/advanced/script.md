---
lang: zh-cn
title: 内置脚本语言
---

# 内置脚本语言

::: info 本节内容

本节将介绍海豹内置的脚本语言，请善用侧边栏和搜索，按需阅读文档。

:::

## 语法

### 变量机制

你可能注意到，这里出现了一些`san` 、`$t玩家`之类的东西，这些是SealDice中的**变量**。

内置变量有：

| 变量名         | 内容                                                 | 示例结果                |
| -------------- | ---------------------------------------------------- | ----------------------- |
| $t玩家         | 当前人物卡的名字，如果不存在则为群昵称或QQ昵称。     | <木落>                  |
| $t玩家_RAW     | 同上，但没有<>                                       | 木落                    |
| $tQQ昵称       | QQ昵称                                               | <木落>                  |
| $t账号ID       | 海豹格式的ID                                         | QQ:123456789            |
| $t账号ID_RAW   | 原始格式的ID                                         | 123456789               |
| $tQQ           | 海豹格式的ID                                         | QQ:123456789            |
| $t群名         | 群名                                                 | 海豹核心·SealDice用户群 |
| $t群号         | 海豹格式的ID                                         | QQ-Group:987654321      |
| $t群号_RAW     | 原始格式的ID                                         | 987654321               |
| $t个人骰子面数 | 个人骰子面数                                         | 100                     |
| $tDate         | 数字格式的现日期                                     | 20230109                |
| $tYear         | 数字格式的年份                                       | 2023                    |
| $tMonth        | 数字格式的现月份                                     | 1                       |
| $tDay          | 数字格式的现日期                                     | 9                       |
| $tWeekday      | 数字格式的星期（1-7）                                | 1                       |
| $tHour         | 数字格式的现时间（小时）                             | 15                      |
| $tMinute       | 数字格式的现时间（分钟）                             | 41                      |
| $tSecond       | 数字格式的现时间（秒）                               | 55                      |
| $tTimestamp    | 数字格式的10位时间戳                                 | 1673250115              |
| $t文本长度     | 触发消息的文本，汉字长度为3，英文字母和数字长度为1。 | 6                       |
| $t平台         | 触发的平台                                           | QQ                      |
| $t游戏模式     | 随.set coc/dnd改变                                   | coc7                    |
| $t消息类型     | 触发位置为群还是私聊。（group/private）              | group                   |
| 娱乐:今日人品  | 自定义文案                                           | <木落>的今日人品为0     |
| 常量:APPNAME   | 软件名                                               | SealDice                |
| 常量:VERSION   | 版本号                                               | 0.91测试版 v20220228    |
| $tMsgID        | 消息ID，仅自定义回复中可用。                         | -123                    |

变量的名称可以是汉字、字母和数字，`$t`是一个特殊的变量前缀。

*注: 所有自定义文案均为可用变量。

| 变量名字 | 用途                     | 举例             |
| -------- | ------------------------ | ---------------- |
| 普通名字 | 玩家的角色属性           | 理智、力量、智力 |
| $t开头   | 个人临时变量，不存数据库 | $t随机点数       |
| $m开头   | 个人变量，跨群存在       | $m今日人品       |
| $g开头   | 群变量，群内所有人共享   | $g群主体重       |

所有变量均可以在`.rx` / `.rxh` / `.ra`/`.text`等指令中、以及在自定义文案(`text-template.yaml`)中使用

> 如果一部分变量无效，请检查海豹是否为最新版本。

#### 常用变量名表

$t判定结果 // 大成功 成功 失败
$t判定值
$t增量
$t新值
$t旧值
$t变化量
$t表达式文本
$t数量
$t失败数量
$t成功数量
$t属性
$t结果文本
$t计算过程


### 数据类型和赋值语句

```
// 文本类型 <- 注意，目前并不支持写注释，此为教程
$t0 = '文本'
$t0 = "也是文本"
$t0 = `特殊文本类型，可以插入表达式，例如，玩家的力量数值: {力量}`
$t0 = `另一种插入表达式的写法 {% 力量 %} `

// 数字类型
$t0 = 1

// 布尔 没有专门的布尔类型，0或空字符串被视为False，非零和非空字符串为True
$t0 > 1
$t0 >= 1
$t0 == 1
$t0 != 1
$t0 < 1
$t0 <= 1
```



### 语句

多个语句可以用 ; 分隔，取分隔后的最后一项的值，为整个表达式的值，例如：

```
$t0 = 1;2;3
```

此时$t0的值为3



### 运算符

#### 数学运算

```
加减乘除余 + -* / %
乘方 ^ ** // 2 ** 3 或 2 ^ 3 即2的3次方
```



#### 骰子算符

d 常规骰子算符，用法举例 d20  2d20k1  d20优势

f  命运骰，随机骰4次，每骰结果可能是-1 0 1，记为- 0 +

b 奖励骰(COC)

p 惩罚骰(COC)

c 双十字



### 条件算符 (?)

```
灵视 >= 40 ? '如果灵视达到40以上，你就能看到这句话'
```

可以用这个指令测试，下同：

```
.st 灵视41
.text {灵视 >= 40 ? '如果灵视达到40以上，你就能看到这句话'}
```



#### 多重条件算符 (? ,)

```
灵视 >= 80 ? '看得很清楚吗？',
灵视 >= 50 ? '不错，再靠近一点……',
灵视 >= 30 ? '仔细听……',
灵视 >= 0 ? '呵，无知之人。'
```

应用举例，默认的jrrp

```
{$t玩家} 今日人品为{$t人品}，{%
    $t人品 > 95 ? '人品爆表！',
    $t人品 > 80 ? '运气还不错！',
    $t人品 > 50 ? '人品还行吧',
    $t人品 > 10 ? '今天不太行',
    1 ? '流年不利啊！'
%}
```



#### 三目运算符 (? :)

```
灵视 >= 40 ? '如果灵视达到40以上，你就能看到这句话' : '无知亦是幸运'
```



### 条件语句

注意：如果下面的代码输出“格式化错误”，那是因为你的$t0不是数值；字符串当然不能和数值比较大小，所以会报错。
解决方法：`.text {$t0=0}`

```
if $t0 > 10 {
    $t1 = "aaa"
} else {
    $t1 = 'bbb'
}
```

```
实际测试:
.text {% if $t0 > 10 { $t1="aaa"} else { $t1 = 'bbb' }; $t1 %}
```
